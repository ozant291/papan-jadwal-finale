<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title></title>

<!-- UI font + angka digital stabil -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#070b12; --surface:#0c121e; --surface2:#0a0f19;
  --text:#e7ecf3; --muted:#9aa6b6; --line:#223049;
  --danger:#ff5b5b; --good:#31df6a;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text);
  background:radial-gradient(1400px 700px at 50% -10%,#101a36 0%, #070b12 60%);
  font:16px/1.5 Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
}
button{font:inherit}

/* ===== Layout ===== */
.app{height:100%;padding:18px;display:flex;flex-direction:column;gap:14px}

/* Toolbar */
.toolbar{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:8px}
.left-tools,.right-tools{display:flex;gap:8px;align-items:center}
.center-tools{display:flex;justify-content:center}
.tool{border:1px solid var(--line);background:#0e172a;color:#fff;border-radius:12px;padding:10px 12px;cursor:pointer}
.tool.big{font-weight:900;font-size:clamp(18px,2vw,28px);padding:14px 24px;border-radius:16px;background:#16233a;border:2px solid var(--line)}
.brand{opacity:.7;font-weight:800;letter-spacing:.8px}

/* Grid kartu */
.cards{flex:1;display:grid;grid-template-columns:repeat(4,1fr);gap:18px}
@media (max-width:1100px){.cards{grid-template-columns:repeat(2,1fr)}}
@media (max-width:640px){.cards{grid-template-columns:1fr}}

/* Kartu */
.card{
  position:relative;border-radius:28px;padding:20px;
  background:
    radial-gradient(300px 140px at 50% 0%, rgba(255,255,255,.06), transparent 60%),
    linear-gradient(180deg,var(--surface),var(--surface2));
  border:2px solid #1b2740;box-shadow:0 18px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
  display:flex;flex-direction:column;align-items:center;
}
.card.active{border-color:var(--danger);box-shadow:0 0 42px rgba(255,80,80,.35),0 18px 40px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,255,255,.04)}

.start-time{font-weight:900;font-size:clamp(18px,1.8vw,26px);color:var(--danger);margin:2px 0 8px}
.start-time.off{color:#5f6b7a}

/* Avatar bulat + ring */
.avatar-wrap{position:relative;margin:6px 0 8px;width:clamp(160px,20vw,260px);height:clamp(160px,20vw,260px)}
.ring{position:absolute;inset:0;border-radius:50%;background:conic-gradient(var(--ring-color,#223049) var(--ring-deg,0deg), #22304922 0)}
.avatar-ring{position:absolute;inset:10px;border-radius:50%;overflow:hidden;border:6px solid #1b2740;background:#0f1a30;display:grid;place-items:center;box-shadow:inset 0 0 0 2px rgba(255,255,255,.03)}
.avatar{width:100%;height:100%;object-fit:cover;object-position:var(--face-pos,50% 50%)}
.card.active .avatar{animation:swayX var(--osc,2s) ease-in-out infinite alternate;will-change:transform}
@keyframes swayX{0%{transform:translateX(-3%)}100%{transform:translateX(3%)}}

/* Nama & kelas */
.name{font-weight:900;letter-spacing:.4px;text-align:center;font-size:clamp(22px,2.8vw,40px);margin:6px 0 2px}
.class{font-weight:800;color:#b7c3d7;margin-bottom:8px}

/* Kontrol */
.controls{display:flex;gap:12px;margin-bottom:8px}
.icon{width:clamp(46px,5.2vw,74px);height:clamp(46px,5.2vw,74px);border-radius:14px;border:2px solid #24314a;background:#0c1628;color:#fff;display:grid;place-items:center;cursor:pointer;box-shadow:0 8px 18px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04)}
.icon svg{width:60%;height:60%}

/* Angka besar (Share Tech Mono) */
.metrics{margin-top:auto;width:100%;display:flex;flex-direction:column;gap:10px;align-items:center;padding-bottom:6px;min-height:clamp(140px,22vh,220px)}
.metric{width:100%;text-align:center}
.label{font-size:clamp(14px,1.4vw,18px);color:var(--muted);font-weight:800;letter-spacing:.8px;margin-bottom:2px}
.digits{
  font-family:"Share Tech Mono", monospace; font-weight:400;
  font-variant-numeric:tabular-nums; letter-spacing:2px; line-height:1;
  font-size:clamp(46px,10vw,112px); text-shadow:0 0 8px rgba(255,255,255,.05); display:block;
}
.total .digits{color:var(--good)}
.hidden{display:none}

/* Overlay Jadwal */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);display:none;z-index:1000}
.overlay.show{display:block}
.sheet{position:absolute;inset:42px 20px;background:#0a0f19;border:1px solid var(--line);border-radius:18px;padding:14px;overflow:auto;display:flex;flex-direction:column;gap:14px}
.top{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
.h1{font-weight:900;font-size:clamp(40px,8vw,90px);letter-spacing:1px;text-align:center;margin:0}
.sub{font-weight:800;color:#b8c7de;text-align:center;margin-top:-6px}
.tabs{display:flex;gap:6px;flex-wrap:wrap;justify-content:center}
.tab{padding:8px 12px;border-radius:10px;border:1px solid var(--line);background:#0c1628;color:#cfe2ff;font-weight:800;cursor:pointer}
.tab.active{background:#16233a}
.tab.today{outline:2px solid #35507c;outline-offset:2px}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
@media (max-width:1100px){.grid{grid-template-columns:repeat(2,1fr)}}
@media (max-width:640px){.grid{grid-template-columns:1fr}}
.col{background:#0f1524;border:1px solid var(--line);border-radius:16px;padding:14px}
.col .head{font-weight:900;text-align:center;letter-spacing:.6px;font-size:clamp(28px,4.2vw,46px);margin-bottom:4px}
.col .cls{text-align:center;color:#b8c1d1;margin-bottom:10px;font-size:clamp(20px,3vw,30px);font-weight:800}
.slot{border:1px dashed var(--line);border-radius:10px;padding:10px;margin:8px 0;background:#0b1221}
.input{width:100%;font-size:clamp(18px,2.4vw,24px);padding:10px;border-radius:10px;border:1px solid var(--line);background:#0b1221;color:#fff}

.badge{padding:6px 10px;border-radius:10px;background:#0d1a30;color:#9db5d8;border:1px solid #223049}
</style>
</head>
<body>
<div class="app">
  <div class="toolbar">
    <div class="left-tools">
      <span class="brand badge">PAPAN JADWAL</span>
      <button class="tool" id="btnFull">â›¶ Fullscreen</button>
    </div>
    <div class="center-tools">
      <button class="tool big" id="btnSchedule">ðŸ“˜ Jadwal Pelajaran</button>
    </div>
    <div class="right-tools">
      <button class="tool" id="btnExport">Ekspor</button>
      <label class="tool" style="cursor:pointer">Impor
        <input id="importFile" type="file" accept="application/json" style="display:none">
      </label>
    </div>
  </div>

  <div class="cards" id="cards"></div>
</div>

<!-- Overlay Jadwal -->
<div class="overlay" id="ol">
  <div class="sheet">
    <div class="top">
      <button class="tool" id="olClose">Tutup âœ•</button>
      <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:2px">
        <div class="h1" id="dayTitle">SENIN</div>
        <div class="sub">JADWAL PELAJARAN</div>
      </div>
      <span class="badge" id="todayBadge"></span>
    </div>
    <div class="tabs" id="tabs"></div>
    <div class="grid" id="schedGrid"></div>
    <div style="display:flex;justify-content:center"><span class="badge">Data tersimpan di browser (localStorage)</span></div>
  </div>
</div>

<script>
/* ===== Data & Config ===== */
const KIDS=["Faatih","Affan","Hana","Adel"];
const CLASS_OF={Faatih:"KELAS VI",Affan:"KELAS IV",Hana:"KELAS I",Adel:"KELAS II"};
const PHOTOS={Faatih:"img/faatih.jpg",Affan:"img/affan.jpg",Hana:"img/hana.jpg",Adel:"img/adel.jpg"};
const PHOTOS_RUN={Faatih:"img/faatih_play.jpg",Affan:"img/affan_play.jpg",Hana:"img/hana_play.jpg",Adel:null}; // Adel tidak ganti
const FACE_POS={Faatih:"50% 42%",Affan:"50% 45%",Hana:"50% 45%",Adel:"50% 50%"};

const DAY_KEYS=["Min","Sen","Sel","Rab","Kam","Jum","Sab"];
const DAY_LABEL={Min:"Minggu",Sen:"Senin",Sel:"Selasa",Rab:"Rabu",Kam:"Kamis",Jum:"Jumat",Sab:"Sabtu"};
const SCHED_KIDS=["Faatih","Affan","Hana"]; // tanpa Adel
const HIDE_ZERO_TOTAL=true;

const todayKey=()=>DAY_KEYS[new Date().getDay()];
const todayStr=()=>new Date().toISOString().slice(0,10);
const $=(s,r=document)=>r.querySelector(s);

function defKid(n){return{
  name:n, class:CLASS_OF[n]||"", faceY:FACE_POS[n]||"50% 50%", dailyLimitMin:120,
  schedule:{Sen:["","","",""],Sel:["","","",""],Rab:["","","",""],Kam:["","","",""],Jum:["","","",""],Sab:["","","",""],Min:["","","",""]},
  timer:{date:todayStr(),running:false,start:null,totalMs:0}
}}
function load(){try{return JSON.parse(localStorage.getItem('papan.v5'))}catch{return null}}
function save(){localStorage.setItem('papan.v5',JSON.stringify(DATA))}
let DATA=load()||KIDS.map(defKid);
KIDS.forEach(n=>{if(!DATA.find(k=>k.name===n)) DATA.push(defKid(n))}); save();

/* ===== UI ===== */
const cardsEl=$("#cards"); let TICK=null;
const SVG={
  play:`<svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>`,
  stop:`<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h12v12H6z"/></svg>`,
  reset:`<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 6V3l-4 4 4 4V8a4 4 0 11-4 4H6a6 6 0 106-6z"/></svg>`
};
function fmtMs(ms){const s=Math.floor(ms/1000),m=Math.floor((s%3600)/60),ss=s%60;return `${String(m).padStart(2,'0')}:${String(ss).padStart(2,'0')}`}
function fmtHM(d){return `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`}
function currentPhoto(n,run){return (run&&PHOTOS_RUN[n])?PHOTOS_RUN[n]:PHOTOS[n]||placeholder(n)}
function placeholder(n){const i=n[0].toUpperCase();return `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='240' height='240'><rect width='240' height='240' fill='%232a3346'/><text x='50%' y='52%' font-size='104' fill='white' text-anchor='middle' font-family='Poppins' dy='.3em'>${i}</text></svg>`}

function renderCards(){
  cardsEl.innerHTML="";
  KIDS.forEach(name=>{
    const k=DATA.find(x=>x.name===name);
    const run=k.timer.running;
    const cur=run?(Date.now()-new Date(k.timer.start).getTime()):0;
    const total=k.timer.totalMs+cur;
    const limitMs=(k.dailyLimitMin||0)*60000;
    const pct=limitMs>0?Math.min(1,total/limitMs):0;
    const ringDeg=Math.round(360*pct)+'deg';
    const ringColor=pct<.7?'#2dd4bf':(pct<.95?'#f59e0b':'#ff5b5b');

    const card=document.createElement('div');
    card.className=`card ${run?'active':''}`;
    card.dataset.kid=name;
    card.innerHTML=`
      <div class="start-time ${run?'':'off'}">${run?fmtHM(new Date(k.timer.start)):'--:--'}</div>
      <div class="avatar-wrap" style="--ring-deg:${ringDeg};--ring-color:${ringColor}">
        <div class="ring"></div>
        <div class="avatar-ring" style="--face-pos:${k.faceY}">
          <img class="avatar" src="${currentPhoto(name,run)}" alt="${name}">
        </div>
      </div>
      <div class="name">${name}</div>
      <div class="class">${k.class||''}</div>
      <div class="controls">
        <button class="icon" data-act="start" title="Mulai">${SVG.play}</button>
        <button class="icon" data-act="stop"  title="Stop">${SVG.stop}</button>
        <button class="icon" data-act="reset" title="Reset Timer">${SVG.reset}</button>
      </div>
      <div class="metrics">
        <div class="metric"><div class="label">TIMER</div><div class="digits" data-cur>${fmtMs(cur)}</div></div>
        <div class="metric total ${HIDE_ZERO_TOTAL&&total===0?'hidden':''}">
          <div class="label">TOTAL HARI INI</div><div class="digits" data-total>${fmtMs(total)}</div>
        </div>
      </div>`;
    cardsEl.appendChild(card);

    // actions
    card.addEventListener('click',e=>{
      const act=e.target.closest('.icon')?.dataset.act; if(!act) return;
      if(act==='start') startTimer(k);
      if(act==='stop')  stopTimer(k);
      if(act==='reset') resetTimer(k); // <- reset tanpa dialog, tidak mengubah total
    });
    card.querySelector('.avatar-ring').onclick=()=>toggle(k);
  });
  startTicker();
}

const BASE_OSC=2.0, MIN_OSC=.35, STEP=.1;
const osc=(ms)=>`${Math.max(MIN_OSC,BASE_OSC-STEP*Math.floor(ms/60000)).toFixed(2)}s`;
function toggle(k){k.timer.running?stopTimer(k):startTimer(k)}
function startTimer(k){ if(!k.timer.running){ k.timer.running=true;k.timer.start=new Date().toISOString(); save(); renderCards(); } }
function stopTimer(k){ if(k.timer.running){ const ms=Date.now()-new Date(k.timer.start).getTime(); k.timer.running=false;k.timer.start=null;k.timer.totalMs+=ms; save(); renderCards(); } }
/* Reset: hanya sesi berjalan, total tetap */
function resetTimer(k){ k.timer.running=false; k.timer.start=null; save(); renderCards(); }

function startTicker(){
  if(TICK) clearInterval(TICK);
  TICK=setInterval(()=>{
    const t=todayStr();
    DATA.forEach(k=>{if(k.timer.date!==t){k.timer.date=t;k.timer.running=false;k.timer.start=null;k.timer.totalMs=0}});
    [...cardsEl.children].forEach(card=>{
      const name=card.dataset.kid; const k=DATA.find(x=>x.name===name);
      const run=k.timer.running; const cur=run?(Date.now()-new Date(k.timer.start).getTime()):0; const total=k.timer.totalMs+cur;
      card.classList.toggle('active',run);
      card.querySelector('.start-time').textContent=run?fmtHM(new Date(k.timer.start)):'--:--';
      card.querySelector('.start-time').classList.toggle('off',!run);
      card.querySelector('[data-cur]').textContent=fmtMs(cur);
      const tot=card.querySelector('.total'); tot.querySelector('[data-total]').textContent=fmtMs(total); tot.classList.toggle('hidden',HIDE_ZERO_TOTAL&&total===0);
      const limitMs=(k.dailyLimitMin||0)*60000, pct=limitMs>0?Math.min(1,total/limitMs):0;
      const ringDeg=Math.round(360*pct)+'deg', ringColor=pct<.7?'#2dd4bf':(pct<.95?'#f59e0b':'#ff5b5b');
      card.querySelector('.avatar-wrap').style.setProperty('--ring-deg',ringDeg);
      card.querySelector('.avatar-wrap').style.setProperty('--ring-color',ringColor);
      const img=card.querySelector('.avatar'), want=currentPhoto(name,run);
      if(img.src!==new URL(want,location.href).href) img.src=want;
      if(run) img.style.animationDuration=osc(cur); else { img.style.animation='none'; img.offsetHeight; img.style.animation=''; }
    });
  },250);
}

/* ===== Jadwal Pelajaran ===== */
const ol=$("#ol"), tabs=$("#tabs"), schedGrid=$("#schedGrid"), todayBadge=$("#todayBadge"), dayTitleEl=$("#dayTitle");
$("#btnSchedule").onclick=()=>openSchedule(todayKey());
$("#olClose").onclick=()=>ol.classList.remove("show");

function openSchedule(activeKey){
  dayTitleEl.textContent=(DAY_LABEL[activeKey]||"").toUpperCase();
  const tKey=todayKey();
  todayBadge.textContent=`Hari ini: ${DAY_LABEL[tKey]}`;

  tabs.innerHTML="";
  DAY_KEYS.forEach(k=>{
    const b=document.createElement('button');
    b.className='tab'; if(k===activeKey) b.classList.add('active'); if(k===tKey) b.classList.add('today');
    b.textContent=DAY_LABEL[k]; b.onclick=()=>openSchedule(k);
    tabs.appendChild(b);
  });

  schedGrid.innerHTML="";
  SCHED_KIDS.forEach(n=>{
    const kid=DATA.find(x=>x.name===n), list=kid.schedule[activeKey]||[];
    const col=document.createElement('div'); col.className='col';
    col.innerHTML=`<div class="head">${n}</div><div class="cls">${kid.class||''}</div>
      ${[0,1,2,3].map(i=>`<div class="slot"><input class="input" data-k="${n}" data-day="${activeKey}" data-i="${i}" value="${list[i]||''}" placeholder="Pelajaran ${i+1}"/></div>`).join('')}`;
    schedGrid.appendChild(col);
  });
  schedGrid.oninput=(e)=>{const t=e.target; if(!t.classList.contains('input')) return; const kid=DATA.find(x=>x.name===t.dataset.k); kid.schedule[t.dataset.day][+t.dataset.i]=t.value; save();};
  ol.classList.add('show');
}

/* ===== Tools ===== */
$("#btnFull").onclick=()=>{ if(!document.fullscreenElement) document.documentElement.requestFullscreen?.(); else document.exitFullscreen?.(); };
$("#btnExport").onclick=()=>{ const blob=new Blob([JSON.stringify(DATA,null,2)],{type:"application/json"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download="papan_jadwal_backup.json"; a.click(); URL.revokeObjectURL(url); };
$("#importFile").addEventListener("change",(e)=>{const f=e.target.files?.[0]; if(!f)return; const r=new FileReader(); r.onload=()=>{ try{ DATA=JSON.parse(r.result); save(); renderCards(); alert("Impor berhasil"); }catch{ alert("File tidak valid"); } }; r.readAsText(f);});

/* ===== Reset tengah malam ===== */
(function scheduleMidnight(){
  const now=new Date(); const mid=new Date(now); mid.setHours(24,0,0,0);
  setTimeout(()=>{ const t=todayStr(); DATA.forEach(k=>{k.timer.date=t;k.timer.running=false;k.timer.start=null;k.timer.totalMs=0;}); save(); renderCards(); scheduleMidnight(); }, mid-now);
})();

/* Boot */
renderCards();
</script>
</body>
</html>

